"""
This bot checks for new posts in r/sudoku every 2 hours and emails the link to you    
If you run this yourself, in gmail settings turn on pop/imap
and turn off blocked access under lesssecureappssecurity
"""


import praw
import time
import smtplib

r = praw.Reddit(user_agent = "I want notifications for new posts to r/sudoku - 'put your reddit username here'")
print("Connected")

cache = []

def main():    
    subreddit = r.get_subreddit("sudoku")
    posts = subreddit.get_new(limit = 20)
    for post in posts:
        if post.id not in cache:
            smtpObj = smtplib.SMTP('smtp.gmail.com', 587)
            smtpObj.ehlo()
            smtpObj.starttls()
            smtpObj.login('yourgmailaccount', 'yourgmailpassword')
                #note: use a throwaway for this because you are literally giving reddit the password for the email account
                #this is the account that sends the link so it doesn't matter, below is your personal account
            cache.append(post.id)
            f = '\n' + post.url + '\n'
            smtpObj.sendmail('throwawayaccount@gmail.com','yourpersonalaccount@gmail.com', 'Subject: New Post in r/sudoku\n' + f)
            smtpObj.quit()
while True:
    main()
    time.sleep(7200000)
